<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mngNtce">

	<select id="getNtceMenu" resultType="java.util.HashMap">
		SELECT	MENU_CD 		AS code
				,MENU_KRN_NM 	AS name
		FROM 	HIST_MENU 
		WHERE  	MENU_CATE IS NULL
	</select>

	<select id="getNtceDtls" resultType="string" >
		SELECT	NVL(CTN_DTLS, EMPTY_CLOB()) AS CTN_DTLS
		FROM 	HIST_CTN 
		WHERE  	MENU_CD = #{MENU_CD}
	</select>
	
	<insert id="insertNtceDtls">
		INSERT INTO HIST_CTN (
        	MENU_CD
        	,CTN_DTLS
			,RGST_EMP_NUM
			,RGST_DTIM
        )
        VALUES (
	        #{MENU_CD, jdbcType=VARCHAR}
			,#{CTN_DTLS, jdbcType=CLOB}
			,#{SES_USR_NM}
			,sysdate
        )
	</insert>
	
	<update id="updateNtceDtls">
		UPDATE HIST_CTN
	        SET
			CTN_DTLS = #{CTN_DTLS, jdbcType=CLOB}
			,CORCT_EMP_NUM = #{RGST_EMP_NUM, jdbcType=VARCHAR}
			,CORCT_DTIM = sysdate
        WHERE MENU_CD = #{MENU_CD}
	</update>	
	
	<update id="mergeNtceDtls" parameterType="java.util.HashMap">
		MERGE INTO HIST_CTN A
        USING DUAL ON (A.MENU_CD = #{MENU_CD, jdbcType=VARCHAR})
        WHEN MATCHED THEN
        	UPDATE 
	        SET
			CTN_DTLS = #{CTN_DTLS, jdbcType=CLOB, javaType=String}
			,CORCT_EMP_NUM = #{SES_USR_NM}
			,CORCT_DTIM = sysdate
		WHEN NOT MATCHED THEN
		INSERT (
        	MENU_CD
        	,CTN_DTLS
			,RGST_EMP_NUM
			,RGST_DTIM
        )
        VALUES (
	        #{MENU_CD, jdbcType=VARCHAR}
			,#{CTN_DTLS, jdbcType=CLOB}
			,#{SES_USR_NM}
			,sysdate
        )
	</update>
	
	<select id="getIsMenuCdInsertable" resultType="string">
		SELECT
		       CASE COUNT(*)
		         WHEN 0
		         THEN 'N'
		         ELSE 'Y'
		       END AS AVAIL_YN
		  FROM HIST_CTN
		 WHERE MENU_CD = #{MENU_CD}
	</select>

</mapper>